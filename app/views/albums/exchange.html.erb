<div>
  <a href="/albums/<%= @the_album.id %>">
    Go back to album
  </a>
</div>

<div>
  <div>
    <h1>
      <%= @the_album.name %> | Card: <%= @card_number %>
    </h1>
  </div>
</div>

<hr>

<div>
  <div>
    <h2>Users who have card <%= @card_number %> repeated:</h2>
    <table border="1">
      <tr>
        
        <th>
          Name
        </th>

        <th>
          Zip Code
        </th>

        <th>
          Card this user needs
        </th>

        <th>
          How many you have
        </th>

        <th>
          
        </th>
      </tr>

      <% @exchange_hash.keys.each do |a_collector| %>
        
        <% user = User.where({id: a_collector}).first %>
      
        <% @exchange_hash.fetch(a_collector).keys.each do |a_card| %>
          <tr>
            
            <td>
              <%= User.full_name(a_collector) %>            
            </td>

            <td>
              <%= user.zip_code %>
            </td>

            <td>
              <%= a_card %>
            </td>

            <td>
              <%= @exchange_hash.fetch(a_collector).fetch(a_card) %>
            </td>

            <td>

              <% check = Exchange.check_request(@the_album.id, session[:user_id], a_card, user.id, @card_number) %>
              <% if check == false %>
                <form action="/insert_exchange" method="post">
                  <div>
                    <label for="id_album_box"></label>
                    <input type="hidden" value="<%= @the_album.id %>" id="id_album_box" name="query_album_id">
                  </div>

                  <div>
                    <label for="id_sender_box"></label>
                    <input type="hidden" value="<%= session[:user_id] %>" id="id_sender_box" name="query_id_sender">
                  </div>

                  <div>
                    <label for="id_card_sender_box"></label>
                    <input type="hidden" value="<%= a_card %>" id="id_card_sender_box" name="query_card_number_to_send">
                  </div>

                  <div>
                    <label for="id_receiver_box"></label>
                    <input type="hidden" value="<%= user.id %>" id="id_receiver_box" name="query_id_receiver">
                  </div>

                  <div>
                    <label for="id_card_receiver_box"></label>
                    <input type="hidden" value="<%= @card_number %>" id="id_card_receiver_box" name="query_card_number_to_receive">
                  </div>

                  <button>Send exchange request</button>
                </form>
              <% else %>
                  <form action="/exchanges">
                    <button >Check request status</button>
                  </form> 
              <% end %>
            </td>
          </tr>

        <% end %>

      <% end %>
    </table>
  </div>
</div>
